#!/usr/bin/env sh

#
desc='pre-commit git hook.'
#

# This bin path.
  this_path="$(cd "$(dirname "$0")" && pwd)"
  exit_code=0

# Simple logger.
  log_info() {
    printf '[info ] %s\n' "$1"
  }

# Begin info.
  log_info "Begin: $desc"
  log_info "this_path: $this_path"
  log_info "CI: $CI"

# End info.
  end_info() {
    exit_code="$1"

    [ -z "$exit_code" ] && exit_code=0
    log_info "exit_code: $exit_code"
    log_info "End: $desc"
    return "$exit_code"
  }

# Get out of here if this is a CI system.
  if [ -n "$CI" ]; then
    log_info 'Aborting. CI variable detected. This may be a pipeline so git hooks do not need to be run.'
    exit 0
  fi

# Do it.
  log_info 'Begin analysis lint js.'
  npx eslint . || exit_code=1
  log_info 'End analysis lint js.'

  log_info 'Begin analysis format js.'
  npx prettier --check "**/*.{mjs,cjs,js,json,yml,yaml,ts,tsx,md}" || exit_code=1
  log_info 'End analysis format js.'

# End info.
  [ "$exit_code" -eq 0 ] || log_info "Failed: $desc"

  end_info "$exit_code"
